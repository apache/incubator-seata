{
  "Name": "simpleParallelTestStateMachine",
  "Comment": "带并发参数的测试状态机定义",
  "StartState": "FirstState",
  "Version": "0.0.1",
  "States": {
    "FirstState": {
      "Type": "Parallel",
      "Branches": [
        "SecondState",
        "ThirdState"
      ],
      "Parallel": 3,
      "Output": {
        "parallelResult": "$.#root"
      },
      "Next": "ChoiceState"
    },
    "ChoiceState":{
      "Type": "Choice",
      "Choices":[
        {
          "Expression":"[a] == 1",
          "Next":"SecondState"
        },
        {
          "Expression":"[a] == 2",
          "Next":"ThirdState"
        }
      ],
      "Default":"Fail"
    },
    "SecondState": {
      "Type": "ServiceTask",
      "ServiceName": "demoService",
      "ServiceMethod": "bar"
    },
    "ThirdState": {
      "Type": "ServiceTask",
      "ServiceName": "demoService",
      "ServiceMethod": "foo",
      "CompensateState": "CompensateThirdState",
      "Input": [
        {
          "element": "$.[element]",
          "throwException": "$.[fooThrowException]"
        }
      ],
      "Output": {
        "fooResult": "$.#root"
      },
      "Next": "SecondState"
    },
    "CompensateThirdState": {
      "Type": "ServiceTask",
      "ServiceName": "demoService",
      "ServiceMethod": "compensateFoo",
      "Input": [
        {
          "compensateFooInput": "$.[fooResult]",
          "throwException": "$.[compensateFooThrowException]"
        }
      ]
    },
    "CallSubStateMachine": {
      "Type": "SubStateMachine",
      "StateMachineName": "simpleCompensationStateMachine",
      "Loop": {
        "Parallel": 3,
        "Collection": "$.[collection]",
        "ElementVariableName": "element",
        "CompletionCondition": "[nrOfCompletedInstances] / [nrOfInstances] >= 0.4",
        "ElementIndexName": "loopCounter"
      },
      "Input": [
        {
          "a": 1,
          "collection": "$.[collection]",
          "loopCounter": "$.[loopCounter]",
          "element": "$.[element]",
          "barThrowException": "$.[barThrowException]",
          "fooThrowException": "$.[fooThrowException]",
          "compensateFooThrowException": "$.[compensateFooThrowException]"
        }
      ],
      "Output": {
        "fooResult": "$.#root"
      },
      "Next": "Succeed"
    },
    "CompensateFirstState": {
      "Type": "ServiceTask",
      "ServiceName": "demoService",
      "ServiceMethod": "compensateFoo",
      "Input": [
        {
          "compensateFooInput": "$.[fooResult]",
          "throwException": "$.[compensateFooThrowException]",
          "loopCounter": "$.[loopCounter]",
          "element": "$.[element]"
        }
      ]
    },
    "CompensateSecondState": {
      "Type": "ServiceTask",
      "ServiceName": "demoService",
      "ServiceMethod": "compensateBar",
      "Input": [
        {
          "compensateBarInput": "$.[barResult]",
          "loopCounter": "$.[loopCounter]",
          "loopElement": "$.[element]"
        }
      ]
    },
    "CompensationTriggerTest": {
      "Type": "CompensationTrigger",
      "Next": "Fail"
    },
    "Succeed": {
      "Type":"Succeed"
    },
    "Fail": {
      "Type":"Fail",
      "ErrorCode": "NOT_FOUND",
      "Message": "not found"
    }
  }
}